<ion-header class="ion-no-border">
  <div style="background: var(--ion-color-orange)">
    <app-tab-header titulo="Contratados"></app-tab-header>
  </div>

  <ion-segment mode="md" class="segment" value="{{valor_segment}}" #segment>
    <ion-segment-button class="segment_btn" value="chat">
      <ion-label>Chat</ion-label>
    </ion-segment-button>

    <ion-segment-button class="segment_btn" value="detalles">
      <ion-label>Detalles</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="(segment.value === 'chat')" class="flex_row pres_container">
    <div class="flex_row div_presupuesto">
      <ion-label class="label_presupuesto"
        >PRESUPUESTO: {{ presupuesto }} €</ion-label
      >
    </div>

    <div
      style="
        width: 70px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      "
    >
      <ion-icon
        name="close-circle-outline"
        style="height: 25px; width: 25px"
        (click)="onClose()"
      ></ion-icon>
    </div>
  </div>
</ion-header>

<ion-content>
  <div
    *ngIf="(segment.value === 'chat')"
    class="flex_column"
    style="height: 100%; width: 100%"
  >
    <div
      style="
        width: 105%;
        height: 100%;
        display: flex;
        flex-direction: row;
        min-height: 100px;
      "
    >
      <div class="div_chat" #target *ngIf="!chat_vacia">
        <ion-row
          class="chat_bubble"
          lines="none"
          [ngClass]="(user.partner_id ==  message.author_id) ? 'align_right' : 'align_left'"
          *ngFor="let message of messagesList"
        >
          <ng-container
            *ngIf="(user.partner_id ==  message.author_id ); else elseTemplate"
          >
            <div
              style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === ultimo_sms) ? 'bubble_chat_me' : 'bubble_chat_me_old'"
            >
              <div>{{ message.message }}</div>
            </div>
          </ng-container>
          <ng-template #elseTemplate>
            <div
              style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === sms_cliente) ? 'bubble_chat_others' : 'bubble_chat_others_old'"
            >
              <div>{{ message.message }}</div>
            </div>
          </ng-template>
        </ion-row>
      </div>

      <div *ngIf="chat_vacia" class="flex_column">
        <div class="flex_row" class="flex_centered" style="margin-top: 60px">
          <img
            style="width: 55%; height: 55%"
            src="../../../assets/icons/vacio.svg"
          />
        </div>
        <div class="flex_row" class="flex_centered" style="margin-top: 0px">
          <h4 style="color: lightgray; margin-top: 0px">Chat vacio</h4>
        </div>
      </div>

      <div style="height: 100%; width: 5%"></div>
    </div>
    <!-- ************************************************** -->

    <ion-footer class="ion-no-border">
      <div style="display: flex; justify-content: center">
        <div class="flex_row chat_container">
          <ion-textarea
            class="text_area"
            auto-grow
            cols="1"
            rows="1"
            inputmode="text"
            placeholder="Escriba un mensaje..."
            autofocus
            [(ngModel)]="message.message"
          >
          </ion-textarea>

          <div
            style="
              display: flex;
              flex-direction: column;
              justify-content: flex-end;
            "
          >
            <ion-button fill="clear" class="send_btn" (click)="pushToChat()">
              <ion-icon
                name="send"
                color="greenblue"
                style="min-width: 25px; min-height: 30px"
              ></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
    </ion-footer>
  </div>

  <div
    *ngIf="(segment.value === 'detalles')"
    class="flex_column"
    style="height: 100%; width: 100%"
  >
    <ion-list style="padding: 15px 25px 90px 25px !important">
      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_calendar"
              src="/assets/icons/calendario.svg"
            ></ion-img>
            <ion-label class="h3_title">Fecha</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap"
            >{{ task.date_planned |date:'EEEE d.MMMM yyyy' | lowercase
            }}</ion-label
          >
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_schedule"
              src="/assets/icons/hora.svg"
            ></ion-img>
            <ion-label class="h3_title">Horario</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap"
            >{{ task.time |date: 'h:mm a' }}</ion-label
          >
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_direction"
              src="/assets/icons/direccion.svg"
            ></ion-img>
            <ion-label class="h3_title">Dirección</ion-label>
          </div>
          <div class="flex_row">
            <div class="flex_column">
              <ion-label class="h6_title ion-text-wrap"
                >{{ task.address.street}}, Numero: {{ task.address.number
                }},</ion-label
              >
              <div class="flex_row">
                <ion-label
                  class="h6_title ion-text-wrap"
                  *ngIf=" task.address.portal"
                  >Portal: {{ task.address.portal }},
                </ion-label>
                <ion-label
                  class="h6_title ion-text-wrap"
                  *ngIf=" task.address.stair"
                  >Escalera: {{ task.address.stair }},
                </ion-label>
                <ion-label
                  class="h6_title ion-text-wrap"
                  *ngIf=" task.address.floor"
                  >Piso: {{ task.address.floor }},
                </ion-label>
                <ion-label
                  class="h6_title ion-text-wrap"
                  *ngIf=" task.address.door"
                  >Puerta: {{ task.address.door }},
                </ion-label>
              </div>
              <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.cp"
                >Codigo_Postal: {{ task.address.cp }},
              </ion-label>
            </div>

            <div class="flex_centered">
              <img
                class="img_location"
                src="/assets/icons/ubicacion.svg"
                (click)="onClickUbicacion( $event)"
              />
            </div>
          </div>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_price" src="/assets/icons/bolsa.svg"></ion-img>
            <ion-label class="h3_title">Precio</ion-label>
            <ion-button
              class="btn"
              style="min-width: 105px !important"
              color="orange"
              (click)="onClickCostoEntrada( $event )"
            >
              <span style="padding-top: 5px">COSTO EXTRA</span>
            </ion-button>
          </div>
          <div class="flex_row">
            <ion-label class="h6_title ion-text-wrap">
              Total: {{ presupuesto }} €
            </ion-label>
            <ion-button
              class="btn"
              style="min-width: 105px !important"
              color="orange"
              (click)="onClickFactura( $event )"
            >
              <span style="padding-top: 5px">VER FACTURA</span>
            </ion-button>
          </div>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_photo"
              src="/assets/icons/camara.svg"
            ></ion-img>
            <ion-label class="h3_title">Fotos</ion-label>
          </div>
          <div class="flex_column">
            <!-- <ion-label class="h6_title">Antes</ion-label> -->
            <div class="flex_row">
              <div class="flex_column">
                <ion-card
                  [disabled]="habilitar_0"
                  style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  "
                  (click)="imageClick(imagen_0)"
                >
                  <img class="selecf" src="{{imagen_0}}" />
                </ion-card>
              </div>
              <div class="flex_column">
                <ion-card
                  [disabled]="habilitar_1"
                  style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  "
                  (click)="imageClick(imagen_1)"
                >
                  <img class="selecf" src="{{imagen_1}}" />
                </ion-card>
              </div>
              <div class="flex_column">
                <ion-card
                  [disabled]="habilitar_2"
                  style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  "
                  (click)="imageClick(imagen_2)"
                >
                  <img class="selecf" src="{{imagen_2}}" />
                </ion-card>
              </div>
            </div>
          </div>
        </div>
      </ion-item>

      <ion-item
        class="module ion-no-padding"
        style="border: none !important"
        lines="none"
      >
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_contact"
              src="/assets/icons/contacto.svg"
            ></ion-img>
            <ion-label class="h3_title">Cliente</ion-label>
          </div>
          <div class="flex_row">
            <ion-label class="h6_title ion-text-wrap"
              >{{ task.client_name }}</ion-label
            >
            <ion-button
              class="btn"
              color="orange"
              (click)="onClickDenunciar( $event )"
            >
              <span style="padding-top: 5px">DENUNCIAR</span>
            </ion-button>
          </div>
        </div>
      </ion-item>

      <div class="next_button_div">
        <ion-button
          class="btn_finish"
          color="orange"
          (click)="onClickFinalizar( $event )"
        >
          <span style="padding-top: 5px">FINALIZAR TAREA</span>
        </ion-button>
      </div>
    </ion-list>


    <p-dialog header=" " [(visible)]="display" [modal]="true" [style]="{ width: '90vw' }" [baseZIndex]="1000"
  [draggable]="false" [resizable]="false" position="bottom" [dismissableMask]="true" [autoZIndex]="false">

    <div class="flex_row"></div>
     <div class="flex_row" style="justify-content: space-evenly">
      <div class="flex_col">
        <ion-img class="img" src="/assets/icons/noImage.svg"></ion-img>
      </div>
      <div class="flex_col" style="justify-content: start">
        <div style="display: flex">
          <ion-label
            style="
              font-family: 'Helvetica-Roman', sans-serif !important;
              font-size: larger;
            "
            >{{task.client_name}}</ion-label
          >
        </div>
        <div style="display: flex; margin-top: 5px">
          <ion-label style="font-size: large">{{task.type}}</ion-label>
        </div>
      </div>
    </div>
    <div class="flex_row" style="justify-content: stretch; margin-top: 20px">
      <div style="display: flex">
        <ion-label
          style="
            font-family: 'Helvetica-Roman', sans-serif !important;
            font-size: x-large;
            margin-left: 30px;
          "
          >{{task.title}}</ion-label
        >
      </div>
    </div>

    <div class="flex_row" style="justify-content: stretch; margin-top: 25px">
      <div style="display: flex">
        <ion-label
          style="
            font-family: 'Helvetica-Roman', sans-serif !important;

            font-size: medium;
            margin-left: 30px;
          "
          >Evidencia</ion-label
        >
      </div>
    </div>

    <div
      class="flex_row"
      style="justify-content: space-evenly; margin-top: 8px"
    >
      <img class="imgtocar" src="{{foto1}}" (click)="onclickFoto1(0)" />
      <img class="imgtocar" src="{{foto2}}" (click)="onclickFoto1(1)" />
      <img class="imgtocar" src="{{foto3}}" (click)="onclickFoto1(2)" />
    </div>
    <div
      class="flex_row"
      style="justify-content: space-evenly; margin-top: 20px"
    >
      <textarea
        name="Text1"
        cols="10"
        rows="3"
        [(ngModel)]="comentario"
        placeholder="Escriba su comentario"
        style="max-width: 85%; width: 85%; flex: display; padding: 10px"
      ></textarea>
    </div>
    <div class="flex_row" class="init_div">
      <ion-button
        type="submit"
        color="orange"
        style="
          min-width: 100px;
          height: 30px !important;
          font: normal 16px 'Helvetica-Roman', sans-serif;
          --border-radius: 7px;
        "
        (click)="editar()"
      >
        <span style="padding-top: 5px">ENVIAR</span>
      </ion-button>
    </div>
    <div class="flex_row" style="margin-bottom: 5px"></div>
  </p-dialog>  

  </div>


   



  <!-- 
   <ion-footer *ngIf="(segment.value === 'chat')" class="ion-no-border">
    <div style="display: flex; justify-content: center; ">
      <div class="flex_row chat_container">
        <ion-textarea
          class="text_area"
          auto-grow
          cols="1"
          rows="1"
          inputmode="text"
          placeholder="Escriba un mensaje..."
          autofocus
          [(ngModel)]="message.message"
        >
        </ion-textarea>

        <div
          style="
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
          "
        >
          <ion-button fill="clear" class="send_btn" (click)="pushToChat()">
            <ion-icon
              name="send"
              color="greenblue"
              style="min-width: 25px; min-height: 30px"
            ></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </ion-footer>  -->
</ion-content>

<!-- Se agrega el menu lateral -->

<!-- <ion-menu
  contentId="principal"
  menuId="menu-content"
  side="start"
  style="margin-top: 145px !important; --width: 60%"
>
  <ion-header class="ion-no-border">
    <ion-toolbar>
      <ion-title class="menu_title">Menú de cambios</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <div class="flex_row" style="width: 100%">
      <div style="width: 10%"></div>
      <div class="flex_row" style="width: 80%; margin: 20px 0">
        <ion-label
          style="
            font: normal 14px 'Helvetica-Roman', sans-serif;
            text-align: left;
            width: 60%;
          "
          >Presupuesto</ion-label
        >
        <ion-input
          class="pres_input ion-tappable"
          name="password"
          type="text"
          placeholder="5555"
          [(ngModel)]="pre"
        ></ion-input>
      </div>
      <div style="width: 10%"></div>
    </div>

    <div
      style="
        display: flex;
        justify-content: center;
        width: 100%;
        padding-top: 60px;
      "
    >
      <ion-button
        color="orange"
        (click)="onClickEnviar()"
        style="
          font: bold 15px 'Helvetica-Roman', sans-serif;
          height: 30px !important;
          text-transform: uppercase;
        "
      >
        Enviar
      </ion-button>
    </div>
  </ion-content>
</ion-menu>
<ion-router-outlet id="principal"></ion-router-outlet> -->
