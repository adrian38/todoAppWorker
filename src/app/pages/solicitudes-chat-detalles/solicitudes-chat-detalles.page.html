<ion-header class="ion-no-border">
  <div style="background: var(--ion-color-orange)">
    <app-tab-header titulo="Solicitudes"></app-tab-header>
  </div>

  <ion-segment class="segment" value={{valor_segment}} mode="md" #segment>
    <ion-segment-button class="segment_btn" value="chat">
      <ion-label>Chat</ion-label>
    </ion-segment-button>

    <ion-segment-button class="segment_btn" value="detalles">
      <ion-label>Detalles</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="(segment.value === 'chat')" class="flex_row pres_container">
    <div class="flex_row div_presupuesto">
      <ion-label class="label_presupuesto"
        >PRESUPUESTO: {{ presupuesto }} €</ion-label
      >
    </div>

    <div
      style="
        width: 70px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      "
    >
      <ion-icon
        name="close-circle-outline"
        style="height: 25px; width: 25px"
        (click)="onClose()"
      ></ion-icon>
    </div>
  </div>
</ion-header>

<ion-content >
  <div
    *ngIf="(segment.value === 'chat')"
    class="flex_column"
    style="height: 100%; width: 100%"
  >
    <div style="width: 100%; height: 100%; display: flex; flex-direction: row; min-height:100px">
    
      <div class="div_chat" #target *ngIf="!chat_vacia" >
        <ion-row
          class="chat_bubble"
          lines="none"
          [ngClass]="(user.partner_id ==  message.author_id) ? 'align_right' : 'align_left'"
          *ngFor="let message of messagesList"
        >
          <ng-container
            *ngIf="(user.partner_id ==  message.author_id ); else elseTemplate"
          >
            <div
              style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === ultimo_sms) ? 'bubble_chat_me' : 'bubble_chat_me_old'"
            >
              <div>{{ message.message }}</div>
            </div>
          </ng-container>
          <ng-template #elseTemplate>
            <div
              style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === sms_cliente) ? 'bubble_chat_others' : 'bubble_chat_others_old'"
            >
              <div>{{ message.message }}</div>
            </div>
          </ng-template>
        </ion-row>
      </div>

      <div *ngIf="chat_vacia" class="flex_column">
        <div class="flex_row" class="flex_centered" style="margin-top: 60px">
          <img
            style="width: 55%; height: 55%"
            src="../../../assets/icons/vacio.svg"
          />
        </div>
        <div class="flex_row" class="flex_centered" style="margin-top: 0px">
          <h4 style="color: lightgray; margin-top: 0px">Chat vacio</h4>
        </div>
      </div>

      

      <div style="height: 100%; width: 5%"></div>
    </div>
    <!-- -------------------------------------------- -->
    <ion-footer  class="ion-no-border">
      <div style="display: flex; justify-content: center">
        <div class="flex_row chat_container">
          <ion-textarea
            class="text_area"
            auto-grow
            cols="1"
            rows="1"
            inputmode="text"
            placeholder="Escriba un mensaje..."
            autofocus
            [(ngModel)]="message.message"
          >
          </ion-textarea>
    
          <div
            style="display: flex; flex-direction: column; justify-content: flex-end;"
          >
         
            <ion-button fill="clear" class="send_btn"   (click)="pushToChat()">
              <ion-icon
                name="send"
                color="greenblue"
                style="min-width: 25px; min-height: 30px"
              ></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
    </ion-footer>
  </div>

  <div
    *ngIf="(segment.value === 'detalles')"
    class="flex_column"
    style="height: 100%; width: 100%"
  >
    <ion-list style="padding: 15px 25px 0 25px !important">
      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <ion-label class="h2_title">{{ categoria }}</ion-label>
          <ion-label class="h6_title ion-text-wrap"
            >{{ descripcion }}</ion-label
          >
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_calendar"
              src="/assets/icons/calendario.svg"
            ></ion-img>
            <ion-label class="h3_title">Fecha</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap"
            >{{ task.date_planned |date:'EEEE d.MMMM yyyy' | lowercase
            }}</ion-label
          >
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_schedule"
              src="/assets/icons/hora.svg"
            ></ion-img>
            <ion-label class="h3_title">Horario</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap"
            >{{ task.time |date: 'h:mm a' }}</ion-label
          >
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_direction"
              src="/assets/icons/direccion.svg"
            ></ion-img>
            <ion-label class="h3_title">Dirección</ion-label>
          </div>

          <ion-row>
            <ion-label class="h6_title ion-text-wrap"
              >{{task.address.street}}, Numero: {{task.address.number}},
            </ion-label>
            <ion-label *ngIf="task.address.door" class="h6_title ion-text-wrap"
              >Piso: {{task.address.floor}},
            </ion-label>
            <ion-label *ngIf="task.address.stair" class="h6_title ion-text-wrap"
              >Escalera: {{task.address.stair}},
            </ion-label>
            <ion-label
              *ngIf="task.address.portal"
              class="h6_title ion-text-wrap"
              >Portal: {{task.address.portal}}
            </ion-label>
          </ion-row>
          <ion-row>
            <ion-label *ngIf="task.address.cp" class="h6_title ion-text-wrap">
              Codigo_postal: {{task.address.cp}}
            </ion-label>
          </ion-row>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_price" src="/assets/icons/bolsa.svg"></ion-img>
            <ion-label class="h3_title">Precio</ion-label>
          </div>
          <ion-label class="h6_title"
            >Materiales: {{ task.materials }} €
          </ion-label>
          <div class="flex_row">
            <ion-label class="h6_title" style="width: 50% !important"
              >Mano de obra: {{ task.work_force }} €
            </ion-label>
            <ion-label class="h6_title" style="width: 50% !important"
              >TOTAL: {{ task.work_force + task.materials }} €
            </ion-label>
          </div>
        </div>
      </ion-item>

      <ion-item
        class="module ion-no-padding"
        lines="none"
        style="border-bottom: none !important; margin-bottom: 50px"
      >
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img
              class="icon_photo"
              src="/assets/icons/camara.svg"
            ></ion-img>
            <ion-label class="h3_title">Fotos</ion-label>
          </div>

          <div class="flex_row">
            <div class="flex_column">
              <ion-card
                [disabled]="habilitar_0"
                style="
                  border: 0.5px solid rgb(49, 49, 57);
                  width: 80px;
                  height: 80px;
                  border-radius: 5px 5px 5px 5px;
                  margin: 10px 0px;
                "
                (click)="imageClick(imagen_0)"
              >
                <img class="selecf" src="{{imagen_0}}" />
              </ion-card>
            </div>
            <div class="flex_column">
              <ion-card
                [disabled]="habilitar_1"
                style="
                  border: 0.5px solid rgb(49, 49, 57);
                  width: 80px;
                  height: 80px;
                  border-radius: 5px 5px 5px 5px;
                  margin: 10px 0px;
                "
                (click)="imageClick(imagen_1)"
              >
                <img class="selecf" src="{{imagen_1}}" />
              </ion-card>
            </div>
            <div class="flex_column">
              <ion-card
                [disabled]="habilitar_2"
                style="
                  border: 0.5px solid rgb(49, 49, 57);
                  width: 80px;
                  height: 80px;
                  border-radius: 5px 5px 5px 5px;
                  margin: 10px 0px;
                "
                (click)="imageClick(imagen_2)"
              >
                <img class="selecf" src="{{imagen_2}}" />
              </ion-card>
            </div>
          </div>
        </div>
      </ion-item>
    </ion-list>
  </div>

  <!-- <ion-footer *ngIf="(segment.value === 'chat')" class="ion-no-border">
    <div style="display: flex; justify-content: center">
      <div class="flex_row chat_container">
        <ion-textarea
          class="text_area"
          auto-grow
          cols="1"
          rows="1"
          inputmode="text"
          placeholder="Escriba un mensaje..."
          autofocus
          [(ngModel)]="message.message"
        >
        </ion-textarea>
  
        <div
          style="display: flex; flex-direction: column; justify-content: flex-end"
        >
       
          <ion-button fill="clear" class="send_btn"   (click)="pushToChat()">
            <ion-icon
              name="send"
              color="greenblue"
              style="min-width: 25px; min-height: 30px"
            ></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </ion-footer> -->
  
</ion-content>

