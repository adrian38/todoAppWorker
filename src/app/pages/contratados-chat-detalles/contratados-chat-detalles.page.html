<p-toast
[baseZIndex]="3000"
[style]="{width: '250px', height: '25px' , minWidth: '200px'}"
></p-toast>

<!-- Pantalla del presupuesto -->
<p-dialog
  header=" "
  [closable] ="false"
  [(visible)]="display_presupuesto"
  [modal]="true"
  [baseZIndex]="1000"
  [draggable]="false"
  [resizable]="false"
  [style]="{width: '80vw'}"
>
  <div class="flex_column" style="padding: 0px 0px !important">
    <ion-label style="text-align: start; margin-bottom: 5px;font-size: 20px;font-weight: bold;">
      Costos Extras
    </ion-label>
    <ion-label style="margin-top: 3px; margin-bottom: 10px;font-weight: bold;">
    Menu de Cambio
    </ion-label>

    <div class="flex_row" style="margin-top: 25px;">
      <ion-input
      class="custom_input"
      type="number"
      name="mobra"
      [(ngModel)]="mano_obra"
      placeholder="Mano de obra"
      required
    >
    </ion-input>
    </div>

    <div class="flex_row" style="margin-top: 15px;">
      <ion-input
      class="custom_input"
      type="number"
      name="mate"
      [(ngModel)]="materiales"
      placeholder="materiales"
      required
    >
    </ion-input>
    </div>
    
    <div class="flex_row" style="margin-top: 20px;">
      <div class="flex_column">
       
        <span style="padding-top: 5px;color:  var(--ion-color-orange) ;"
              (click)="cancelar()"
              >Cancelar</span>
      
      </div>

      <div class="flex_column">
        <span style="padding-top: 5px;color:  var(--ion-color-orange) ;"
              (click)="actualizar()"
              >Actualizar</span>
      </div>
      
    </div>
  </div>
</p-dialog>





<ion-header class="ion-no-border">
  <div style="background: var(--ion-color-orange)">
    <app-tab-header titulo="Contratados"></app-tab-header>
  </div>

  <ion-segment mode="md" class="segment" value="{{valor_segment}}" #segment>
    <ion-segment-button class="segment_btn" value="chat">
      <ion-label>Chat</ion-label>
    </ion-segment-button>

    <ion-segment-button class="segment_btn" value="detalles">
      <ion-label>Detalles</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="(segment.value === 'chat')" class="flex_row pres_container">
    <div class="flex_row div_presupuesto">
      <ion-label class="label_presupuesto">Costos Extras: {{ presupuesto }} €</ion-label>
    </div>
    <div style="
      width: 70px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    ">

      <img style="width: 20px;height: 20px;" (click)="actualizarPresupesto()"
        src="../../../assets/icons/lapiz_chat.svg" />
      <img style="width: 20px;height: 20px;margin-left: 8px;" (click)="onClose()"
        src="../../../assets/icons/cerrar_chat.svg" />
    </div>
   
  </div>
</ion-header>

<ion-content>
  <div *ngIf="(segment.value === 'chat')" class="flex_column" style="height: 100%; width: 100%">
    <div style="
        width: 105%;
        height: 100%;
        display: flex;
        flex-direction: row;
        min-height: 100px;
      ">
      <div class="div_chat" #target *ngIf="!chat_vacia">
        <ion-row class="chat_bubble" lines="none"
          [ngClass]="(user.partner_id ==  message.author_id) ? 'align_right' : 'align_left'"
          *ngFor="let message of messagesList">
          <ng-container *ngIf="(user.partner_id ==  message.author_id ); else elseTemplate">
            <div style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === ultimo_sms) ? 'bubble_chat_me' : 'bubble_chat_me_old'">
              <div>{{ message.message }}</div>
            </div>
          </ng-container>
          <ng-template #elseTemplate>
            <div style="width: auto; height: auto; max-width: 80%"
              [ngClass]="( message.message === sms_cliente) ? 'bubble_chat_others' : 'bubble_chat_others_old'">
              <div>{{ message.message }}</div>
            </div>
          </ng-template>
        </ion-row>
      </div>

      <div *ngIf="chat_vacia" class="flex_column">
        <div class="flex_row" class="flex_centered" style="margin-top: 60px">
          <img style="width: 55%; height: 55%" src="../../../assets/icons/vacio.svg" />
        </div>
        <div class="flex_row" class="flex_centered" style="margin-top: 0px">
          <h4 style="color: lightgray; margin-top: 0px">Chat vacio</h4>
        </div>
      </div>

      <div style="height: 100%; width: 5%"></div>
    </div>
    <!-- ************************************************** -->

    <ion-footer class="ion-no-border">
      <div style="display: flex; justify-content: center">
        <div class="flex_row chat_container">
          <ion-textarea class="text_area" auto-grow cols="1" rows="1" inputmode="text"
            placeholder="Escriba un mensaje..." autofocus [(ngModel)]="message.message">
          </ion-textarea>

          <div style="
              display: flex;
              flex-direction: column;
              justify-content: flex-end;
            ">
            <ion-button fill="clear" class="send_btn" (click)="pushToChat()">
              <ion-icon name="send" color="greenblue" style="min-width: 25px; min-height: 30px"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>
    </ion-footer>
  </div>

  <div *ngIf="(segment.value === 'detalles')" class="flex_column" style="height: 100%; width: 100%">
    <ion-list style="padding: 15px 25px 90px 25px !important">
      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_calendar" src="/assets/icons/calendario.svg"></ion-img>
            <ion-label class="h3_title">Fecha</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap">{{ task.date_planned |date:'EEEE d.MMMM yyyy' | lowercase
            }}</ion-label>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_schedule" src="/assets/icons/hora.svg"></ion-img>
            <ion-label class="h3_title">Horario</ion-label>
          </div>
          <ion-label class="h6_title ion-text-wrap">{{ task.time |date: 'h:mm a' }}</ion-label>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_direction" src="/assets/icons/direccion.svg"></ion-img>
            <ion-label class="h3_title">Dirección</ion-label>
          </div>

          <!--  <ion-row>
            <ion-label class="h6_title ion-text-wrap"
             >{{task.address.distance}} km
           </ion-label> 

           <ion-img
           class="icon_distancia"
           src="/assets/icons/distancia.svg"
         ></ion-img>
         </ion-row> -->
          <div class="flex_row">
            <div class="flex_column">
              <ion-label class="h6_title ion-text-wrap">{{ task.address.street}}, Numero: {{ task.address.number
                }},</ion-label>
              <div class="flex_row">
                <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.portal">Portal: {{ task.address.portal
                  }},
                </ion-label>
                <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.stair">Escalera: {{ task.address.stair
                  }},
                </ion-label>
                <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.floor">Piso: {{ task.address.floor }},
                </ion-label>
                <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.door">Puerta: {{ task.address.door }},
                </ion-label>
              </div>
              <ion-label class="h6_title ion-text-wrap" *ngIf=" task.address.cp">Codigo_Postal: {{ task.address.cp }},
              </ion-label>
            </div>

            <div class="flex_centered">
              <img class="img_location" src="/assets/icons/ubicacion.svg" (click)="onClickUbicacion()" />
            </div>
          </div>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_price" src="/assets/icons/bolsa.svg"></ion-img>
            <ion-label class="h3_title">Precio</ion-label>
            <ion-button class="btn" style="min-width: 105px !important" color="orange"
              (click)="onClickCostoEntrada( )">
              <span style="padding-top: 5px">COSTO EXTRA</span>
            </ion-button>
          </div>
          <div class="flex_row">
            <ion-label class="h6_title ion-text-wrap">
              Total: {{ presupuesto }} €
            </ion-label>
            <ion-button class="btn" style="min-width: 105px !important" color="orange"
              (click)="onClickFactura(  )">
              <span style="padding-top: 5px">VER FACTURA</span>
            </ion-button>
          </div>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_photo" src="/assets/icons/camara.svg"></ion-img>
            <ion-label class="h3_title">Fotos</ion-label>
          </div>
          <div class="flex_column">
            <!-- <ion-label class="h6_title">Antes</ion-label> -->
            <div class="flex_row">
              <div class="flex_column">
                <ion-card [disabled]="habilitar_0" style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  " (click)="imageClick(imagen_0)">
                  <img class="selecf" src="{{imagen_0}}" />
                </ion-card>
              </div>
              <div class="flex_column">
                <ion-card [disabled]="habilitar_1" style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  " (click)="imageClick(imagen_1)">
                  <img class="selecf" src="{{imagen_1}}" />
                </ion-card>
              </div>
              <div class="flex_column">
                <ion-card [disabled]="habilitar_2" style="
                    border: 0.5px solid rgb(49, 49, 57);
                    width: 80px;
                    height: 80px;
                    border-radius: 5px 5px 5px 5px;
                    margin: 10px 0px;
                  " (click)="imageClick(imagen_2)">
                  <img class="selecf" src="{{imagen_2}}" />
                </ion-card>
              </div>
            </div>
          </div>
        </div>
      </ion-item>

      <ion-item class="module ion-no-padding" style="border: none !important" lines="none">
        <div class="flex_column">
          <div class="flex_row flex_centered">
            <ion-img class="icon_contact" src="/assets/icons/contacto.svg"></ion-img>
            <ion-label class="h3_title">Cliente</ion-label>
          </div>
          <div class="flex_row">
            <ion-label class="h6_title ion-text-wrap">{{ task.client_name }}</ion-label>
            <ion-button class="btn" color="orange" (click)="onClickDenunciar( $event )">
              <span style="padding-top: 5px">DENUNCIAR</span>
            </ion-button>
          </div>
        </div>
      </ion-item>

      <!-- <div class="next_button_div">
        <ion-button class="btn_finish" color="orange" (click)="onClickFinalizar( $event )">
          <span style="padding-top: 5px">FINALIZAR TAREA</span>
        </ion-button>
      </div> -->
    </ion-list>


    <p-dialog header=" " [(visible)]="display" [modal]="true" [style]="{ width: '90vw' }" [baseZIndex]="20000"
      [draggable]="false" [resizable]="false" position="bottom" [dismissableMask]="true" [autoZIndex]="false">

      <div class="flex_row"></div>
      <div class="flex_row" style="justify-content: space-evenly">
        <div class="flex_col">
          <ion-img class="img" src="{{photoProvider}}"></ion-img>
        </div>
        <div class="flex_col" style="justify-content: start">
          <div style="display: flex">
            <ion-label style="
              font-family: 'Helvetica-Roman', sans-serif !important;
              font-size: larger;
            ">{{task.client_name}}</ion-label>
          </div>
          <div style="display: flex; margin-top: 5px">
            <ion-label style="font-size: large">{{task.type}}</ion-label>
          </div>
        </div>
      </div>
      <div class="flex_row" style="justify-content: stretch; margin-top: 20px">
        <div style="display: flex">
          <ion-label style="
            font-family: 'Helvetica-Roman', sans-serif !important;
            font-size: x-large;
            margin-left: 30px;
          ">{{task.title}}</ion-label>
        </div>
      </div>

      <div class="flex_row" style="justify-content: stretch; margin-top: 25px">
        <div style="display: flex">
          <ion-label style="
            font-family: 'Helvetica-Roman', sans-serif !important;

            font-size: medium;
            margin-left: 30px;
          ">Evidencia</ion-label>
        </div>
      </div>

      <div class="flex_row" style="justify-content: space-evenly; margin-top: 8px">
        <ion-img class="imgtocar" [src]="foto1" (click)="onclickFoto1(0)" ></ion-img>
        <ion-img class="imgtocar" [src]="foto2" (click)="onclickFoto1(1)" ></ion-img>
        <ion-img class="imgtocar" [src]="foto3" (click)="onclickFoto1(2)" ></ion-img>
      </div>
      <div class="flex_row" style="justify-content: space-evenly; margin-top: 20px">
        <textarea name="Text1" cols="10" rows="3" [(ngModel)]="comentario" placeholder="Escriba su comentario"
          style="max-width: 85%; width: 85%; flex: display; padding: 10px"></textarea>
      </div>
      <div class="flex_row" class="init_div">
        <ion-button type="submit" color="orange" style="
          min-width: 100px;
          height: 30px !important;
          font: normal 16px 'Helvetica-Roman', sans-serif;
          --border-radius: 7px;
        " (click)="denunciar()">
          <span style="padding-top: 5px">ENVIAR</span>
        </ion-button>
      </div>
      <div class="flex_row" style="margin-bottom: 5px"></div>
    </p-dialog>

  </div>









  

</ion-content>


